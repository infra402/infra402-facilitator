# Post-Settlement Hooks Configuration
#
# For detailed documentation and examples, see: docs/HOOKS_IMPLEMENTATION.md
#
# This file defines custom contract calls that execute atomically with settlement
# transfers via Multicall3.

[hooks]
# Global enable/disable flag for the hook system
enabled = true

# Allow hook calls to fail without reverting the entire batch
# When true: Individual hook calls can fail without reverting transfers
# When false: Any hook failure reverts the entire batch (safer default)
allow_hook_failure = false

# ============================================================================
# Hook Definitions (shared across all networks)
# ============================================================================
# Define your hooks here with function signatures and parameters.
# Contract addresses are specified per-network in [hooks.networks.xxx.contracts].
#
# Hook format:
#   [hooks.definitions.hook_name]
#   enabled = true
#   description = "What this hook does"
#   function_signature = "functionName(type1,type2,...)"
#   gas_limit = 100000
#   [[hooks.definitions.hook_name.parameters]]
#     type = "solidity_type"
#     source = { source_type = "payment|runtime|config|static", field = "..." }
#
# See docs/HOOKS_IMPLEMENTATION.md for complete examples.

[hooks.definitions]
# Add your hook definitions here

# Hook definitions are shared across all networks
[hooks.definitions.token_mint_callback]
enabled = true
description = "EIP3009 token minting with callback"
function_signature = "onPaymentReceived(address,uint256,uint256,uint256,bytes32,uint8,bytes32,bytes32)"

# Parameter 1: from (payer address)
[[hooks.definitions.token_mint_callback.parameters]]
type = "address"
source = { source_type = "payment", field = "from" }

# Parameter 2: value (transfer amount)
[[hooks.definitions.token_mint_callback.parameters]]
type = "uint256"
source = { source_type = "payment", field = "value" }

# Parameter 3: validAfter (EIP-3009 timestamp)
[[hooks.definitions.token_mint_callback.parameters]]
type = "uint256"
source = { source_type = "payment", field = "validafter" }

# Parameter 4: validBefore (EIP-3009 timestamp)
[[hooks.definitions.token_mint_callback.parameters]]
type = "uint256"
source = { source_type = "payment", field = "validbefore" }

# Parameter 5: nonce (EIP-3009 unique nonce)
[[hooks.definitions.token_mint_callback.parameters]]
type = "bytes32"
source = { source_type = "payment", field = "nonce" }

# Parameter 6: v (signature component)
[[hooks.definitions.token_mint_callback.parameters]]
type = "uint8"
source = { source_type = "payment", field = "signaturev" }

# Parameter 7: r (signature component)
[[hooks.definitions.token_mint_callback.parameters]]
type = "bytes32"
source = { source_type = "payment", field = "signaturer" }

# Parameter 8: s (signature component)
[[hooks.definitions.token_mint_callback.parameters]]
type = "bytes32"
source = { source_type = "payment", field = "signatures" }

# Base Sepolia testnet configuration
[hooks.networks.base-sepolia]
enabled = true

# Recipient address → hook names mapping for this network
# Supports environment variable substitution: "${ENV_VAR_NAME}"
[hooks.networks.base-sepolia.mappings]
"${TOKEN_MINT_RECIPIENT_BASE_SEPOLIA}" = ["token_mint_callback"]

# Hook name → contract address mapping for this network
# Supports environment variable substitution: "${ENV_VAR_NAME}"
[hooks.networks.base-sepolia.contracts]
token_mint_callback = "${HOOK_TOKEN_MINT_CALLBACK_BASE_SEPOLIA_CONTRACT}"
